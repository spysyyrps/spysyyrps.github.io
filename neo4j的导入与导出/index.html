

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="一蓑烟雨">
  <meta name="keywords" content="">
  
    <meta name="description" content="&amp;nbsp; &amp;nbsp;  本文主要介绍neo4j的导入（import,load）和导出（export）,基本是基于csv和dump文件格式。将会介绍在终端和使用apoc利用Cypher语言两种情况如何实现导入导出,同时也会大致讲讲所需的csv文件的格式。并且所有的导入导出操作都是在终端或neo4j浏览器界面，并未使用编程语言。  &amp;nbsp; 我的版本配置：   操作系统	:ubuntu22.">
<meta property="og:type" content="article">
<meta property="og:title" content="neo4j的导入与导出">
<meta property="og:url" content="http://example.com/neo4j%E7%9A%84%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA/index.html">
<meta property="og:site_name" content="一蓑烟雨的博客">
<meta property="og:description" content="&amp;nbsp; &amp;nbsp;  本文主要介绍neo4j的导入（import,load）和导出（export）,基本是基于csv和dump文件格式。将会介绍在终端和使用apoc利用Cypher语言两种情况如何实现导入导出,同时也会大致讲讲所需的csv文件的格式。并且所有的导入导出操作都是在终端或neo4j浏览器界面，并未使用编程语言。  &amp;nbsp; 我的版本配置：   操作系统	:ubuntu22.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/08/09/vNZE4nUGx9Ck3Ba.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/09/ZR2kAgm3IWtoMwj.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/09/RACvOsangpDluyX.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/09/unIXg3w9VOToxEN.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/09/pvPhyGdFDw8fBoT.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/09/Ln6vM7k2oIEURwm.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/09/XZM1UFAmkbGdew7.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/20/eAjxtrqD2yCGz68.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/20/KzAPO42uxgt8l3y.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/20/kazcpEDhY3Iu69P.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/20/Pgyr457X1MLF86Y.png">
<meta property="article:published_time" content="2023-08-08T16:00:00.000Z">
<meta property="article:modified_time" content="2023-08-25T15:12:52.604Z">
<meta property="article:author" content="一蓑烟雨">
<meta property="article:tag" content="neo4j">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2023/08/09/vNZE4nUGx9Ck3Ba.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>neo4j的导入与导出 - 一蓑烟雨的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>一蓑烟雨</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="neo4j的导入与导出"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-08-09 00:00" pubdate>
          2023年8月9日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          15k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          82 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">neo4j的导入与导出</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2023年8月25日 晚上
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>&nbsp;</p>
<p>&nbsp;</p>
<blockquote>
<p>本文主要介绍neo4j的导入（import,load）和导出（export）,基本是基于csv和dump文件格式。将会介绍在终端和使用apoc利用Cypher语言两种情况如何实现导入导出,同时也会大致讲讲所需的csv文件的格式。并且所有的导入导出操作都是在终端或neo4j浏览器界面，并未使用编程语言。</p>
</blockquote>
<p>&nbsp;</p>
<p>我的版本配置：</p>
<blockquote>
<ul>
<li><strong>操作系统</strong>	:<strong>ubuntu22.04</strong></li>
<li><strong>neo4j</strong>	<strong>server</strong>:<strong>5.10.0社区版</strong></li>
<li><strong>apoc-core</strong>	:<strong>5.10.1</strong>(这是个neo4j插件，之后会讲到)</li>
</ul>
</blockquote>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id="1-终端下导入导出"><a href="#1-终端下导入导出" class="headerlink" title="1. 终端下导入导出"></a>1. 终端下导入导出</h2><p>（ubuntu ctrl +alt +T 打开终端）。</p>
<p>与neo4j相关的命令基本是以<strong>neo4j</strong>,<strong>neo4j-admin</strong>或者<strong>neo4j-admin server</strong>开头，三者在后面添加 <code>-h</code>都可以查看其帮助文档。</p>
<p><img src="https://s2.loli.net/2023/08/09/vNZE4nUGx9Ck3Ba.png" srcset="/img/loading.gif" lazyload></p>
<p>而我们需要的命令就是<strong>neo4j-admin database</strong></p>
<p>我们使用 <code>neo4j-admin database -h</code>来查看<strong>neo4j-admin database</strong>的使用方法。</p>
<p><img src="https://s2.loli.net/2023/08/09/ZR2kAgm3IWtoMwj.png" srcset="/img/loading.gif" lazyload></p>
<p>而我们要用的就是<strong>dump</strong>,<strong>load</strong>,<strong>import</strong></p>
<p>&nbsp;</p>
<h3 id="dump"><a href="#dump" class="headerlink" title="dump"></a><a target="_blank" rel="noopener" href="https://neo4j.com/docs/operations-manual/current/backup-restore/offline-backup/">dump</a></h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 其中&lt;>是必填选项其余的[]是非必填</span>
<span class="token comment"># 可以使用neo4j-admin database dump -h查看各参数详细信息</span>
<span class="token comment"># 效果是将neo4j的数据导出为一个dump文件，或者一个标准输出流进入类似load的命令</span>
neo4j-admin database dump <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">[</span>--expand-commands<span class="token punctuation">]</span>
                          <span class="token punctuation">[</span>--verbose<span class="token punctuation">]</span> <span class="token punctuation">[</span>--overwrite-destination<span class="token punctuation">[</span><span class="token operator">=</span>true<span class="token operator">|</span>false<span class="token punctuation">]</span><span class="token punctuation">]</span>
                          <span class="token punctuation">[</span>--additional-config<span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">></span><span class="token punctuation">]</span>
                          <span class="token punctuation">[</span>--to-path<span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator">></span> <span class="token operator">|</span> --to-stdout<span class="token punctuation">]</span>
                          <span class="token operator">&lt;</span>database<span class="token operator">></span>
                
<span class="token comment"># --verbose: 加上后会在执行过程中输出详细的过程，方便了解其过程查看可能的错误点</span>
<span class="token comment"># --overwrite-destination: 如果做后dump文件位置存在同名文件，是否覆盖，默认是false</span>
<span class="token comment"># --to-path=&lt;path>： 指定输出文件夹地址。注意！path必须为文件夹地址</span>
<span class="token comment"># --to-stdout: 让输出成为标准输出流而不是一个dump文件</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>&nbsp;</p>
<p>其中，如果你命令中既没有 <code>--to-path</code>也没有 <code>--to-stdout</code>，那么，它将会采用Configuration文件（<a target="_blank" rel="noopener" href="https://neo4j.com/docs/operations-manual/current/configuration/file-locations/">各操作系统下的neo4j默认文件地址</a>）中的 <code>server.directories.dumps.root</code>设置。</p>
<p>该设置值是一个文件路径，指dump文件存放的地址。</p>
<p>如果是相对路径，则是以 <strong>neo4j主目录&#x2F;data&#x2F;<strong>为基准的相对路径。例如 <code>server.directories.dumps.root</code>的默认值就是</strong>dumps</strong>，即如果你命令中既没有 <code>--to-path</code>也没有 <code>--to-stdout</code>，该命令将会在 <strong>neo4j主目录&#x2F;data&#x2F;dumps&#x2F;</strong> 下生成一个dump文件。</p>
<blockquote>
<p><em>如果使用 <code>neo4j-admin database dump</code>来导出数据，要确保neo4j数据库处于stop状态</em></p>
<p><em><code>neo4j status</code>查看当前neo4j运行状态</em></p>
</blockquote>
<p>&nbsp;</p>
<h3 id="load"><a href="#load" class="headerlink" title="load"></a><a target="_blank" rel="noopener" href="https://neo4j.com/docs/operations-manual/current/backup-restore/restore-dump/">load</a></h3><p><strong>load</strong>方法主要就是将<strong>dump</strong>导出的 <em>dump文件</em> 或者 <em>标准输出流</em> 中的数据重新导入neo4j数据库中。所以，load+dump就可以实现neo4j的<strong>离线备份</strong>。</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># load和dump的Options大同小异，</span>
<span class="token comment"># 同样的，如果既没有--from-path，又没有--from-stdin，会采用server.directories.dumps.root</span>
neo4j-admin database load <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">[</span>--expand-commands<span class="token punctuation">]</span> <span class="token punctuation">[</span>--info<span class="token punctuation">]</span> <span class="token punctuation">[</span>--verbose<span class="token punctuation">]</span>
						<span class="token punctuation">[</span>--overwrite-destination<span class="token punctuation">[</span><span class="token operator">=</span>true<span class="token operator">|</span>false<span class="token punctuation">]</span><span class="token punctuation">]</span>
						<span class="token punctuation">[</span>--additional-config<span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">></span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--from-path<span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator">></span> <span class="token operator">|</span> --from-stdin<span class="token punctuation">]</span> <span class="token operator">&lt;</span>database<span class="token operator">></span>
<span class="token comment"># 有一个特殊的Option --info</span>
<span class="token comment"># 如果你加上了这个选项，那么这个命令将不会将数据导入到neo4j数据库中</span>
<span class="token comment"># 而是打印出这个数据的详细信息</span>

<span class="token comment"># example</span>
$ <span class="token function">sudo</span> neo4j-admin database load --from-path<span class="token operator">=</span>/home/mmy intelligentmedicine.db <span class="token parameter variable">--verbose</span>
<span class="token comment"># 这里由于没选覆盖选项是新建一个数据库为intelligentmedicine.db</span>
<span class="token comment"># 注意！path只要写到dump文件所在的文件夹就行，dump文件必须是&lt;databasename>.dump</span>
<span class="token comment"># 这里就是 intelligentmedicine.db.dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>&nbsp;</p>
<p><em>与dump有些不同的是，load支持neo4j在线和离线状态的导入（付费版），但是两种都有要注意的地方</em></p>
<ol>
<li>如果你打算覆盖原有的数据库，即–overwrite-destination设置成了true，那么你<strong>一定</strong>要先<strong>stop</strong>再执行load语句。</li>
<li>如果你打算新建一个数据库来存储你load的数据，那么无需离线，但是在<strong>load之后一定要create一个新的database</strong>。</li>
<li><strong>社区版</strong>的neo4j不支持在线导入，只能关闭服务后导入（付费版没试，但是官方文档说load支持online，应该是指付费版）</li>
<li><strong>社区版</strong>的load不支持<strong>增量导入</strong>，即要么覆盖要么新建数据库，不能在原有数据上加入。（付费版没试，不知道行不行）</li>
</ol>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/docs/cypher-manual/current/administration/databases/">neo4j创建数据库官方文档</a></p>
<p>ps: 社区版即免费的neo4j是<strong>只允许一个database</strong>，但是我们可以通过修改配置文件来实现<strong>多个</strong>database共存。但是也有缺点，每次切换数据库要restart，并且修改配置文件（这个简单，就加个#，删个#）。如果有空会分享一下。</p>
</blockquote>
<p>&nbsp;</p>
<h3 id="import"><a href="#import" class="headerlink" title="import"></a><a target="_blank" rel="noopener" href="https://neo4j.com/docs/operations-manual/current/tutorial/neo4j-admin-import/">import</a></h3><blockquote>
<p><em>The import command is used for loading large amounts of data from CSV files and supports full and incremental import into a running or stopped Neo4j DBMS.</em></p>
<p>上述是官方原话，但是测试发现社区版import只支持全量导入（full）并且只能离线，可能付费才能增量与在线导入。</p>
</blockquote>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Usage: neo4j-admin database import [-h] [COMMAND]</span>

<span class="token comment"># example</span>
$ <span class="token function">sudo</span> neo4j-admin database <span class="token function">import</span> full <span class="token parameter variable">--verbose</span> --overwrite-destination<span class="token operator">=</span>true <span class="token parameter variable">--nodes</span> /home/mmy/forimport_movie_nodes.csv  <span class="token parameter variable">--nodes</span> /home/mmy/forimport_person_nodes.csv  <span class="token parameter variable">--relationships</span> /home/mmy/forimport_rels.csv  test.db<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p> &nbsp;</p>
<h4 id="csv格式"><a href="#csv格式" class="headerlink" title="csv格式"></a>csv格式</h4><p>import命令本身并没有什么好说的，我们来聊聊导入所需的csv文件格式。</p>
<h5 id="a-存储nodes的csv文件"><a href="#a-存储nodes的csv文件" class="headerlink" title="a.存储nodes的csv文件"></a>a.存储nodes的csv文件</h5><p><strong>表头（header）</strong></p>
<ul>
<li>表头格式&lt;name&gt;:&lt;field_type&gt;</li>
<li>label在表头并非必须，但是id一定要有</li>
<li>如果你不想让id加入你的属性值，可以不给它属性名（name），即把下表的movieid去掉。</li>
</ul>
<table>
<thead>
<tr>
<th>movieid:ID</th>
<th>year:int</th>
<th>:LABEL</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>但是如果是增量或者批量导入，规则就有点复杂。<strong>主键的属性必须是标签与属性的结合</strong></li>
</ul>
<table>
<thead>
<tr>
<th>uuid:ID{label:Person}</th>
<th>name:STRING{label:Person}</th>
<th>email:STRING</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>在这里，<strong>uuid</strong>和n<strong>ame共同做主键</strong>区分节点，并且指定节点导入的<strong>label</strong>为<strong>Person</strong></p>
<p><strong>这一措施，主要是防止增量导入和批量导入时创建多个重复节点。</strong></p>
<p>&nbsp;</p>
<h5 id="b-存储relationship的csv文件"><a href="#b-存储relationship的csv文件" class="headerlink" title="b.存储relationship的csv文件"></a>b.存储relationship的csv文件</h5><p><strong>表头</strong></p>
<p>存储关系的表头必须包含**:START_ID<strong>，</strong>:END_ID<strong>和</strong>:TYPE<strong>。其中前两个分别对应着关系的</strong>起始实体<strong>和</strong>结束实体<strong>的</strong>:ID<strong>，这就是为什么实体id是必须的。而</strong>:TYPE**是指明这个关系的类型。</p>
<p>当然，关系也可以有属性，下图便是给关系增加了一个<strong>role</strong>属性</p>
<table>
<thead>
<tr>
<th>：START_ID</th>
<th>:END_ID</th>
<th>:TYPE</th>
<th>role</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>&nbsp;</p>
<blockquote>
<p><strong>总结</strong>：在社区版，如果使用终端的方法，我们都无法实现在线操作与增量导入。而官方其实还有一种方法，使用Cypher命令load csv可以实现在线导入数据，csv文件地址可以是url形式。(<a target="_blank" rel="noopener" href="https://neo4j.com/developer/guide-import-csv/)%E5%A4%A7%E5%AE%B6%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8C%E6%9F%A5%E7%9C%8B%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%8C%E6%9C%89%E6%A0%B7%E4%BE%8B%E5%8D%81%E5%88%86%E8%AF%A6%E7%BB%86%E3%80%82">https://neo4j.com/developer/guide-import-csv/)大家可以自行查看官方文档，有样例十分详细。</a></p>
</blockquote>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id="2-利用apoc插件在线导出"><a href="#2-利用apoc插件在线导出" class="headerlink" title="2. 利用apoc插件在线导出"></a>2. 利用apoc插件在线导出</h2><hr>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/docs/apoc/current/">apoc-core</a></p>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/labs/apoc/5/">apoc-extended</a></p>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/docs/apoc/current/export/">apoc_export</a></p>
<p>apoc在neo4j 5.0之后分为apoc-core和apoc-extended两部分。前者是neo4j官方支持，后者由社区维护。</p>
<p>而由于apoc-extended最新只有5.9版本，作者neo4j为5.10.x，所以下文只使用了apoc-core。而extended在导入导出方面增加了可使用exel导入导出，可以导入html格式的数据，多样化导入csv文件。</p>
<p>apoc本质是一个插件，其内容十分丰富，远不止导入导出数据那么简单，大家如有需要可以查看上方的官方文档。</p>
<p>&nbsp;</p>
<h3 id="2-1-apoc的安装与配置"><a href="#2-1-apoc的安装与配置" class="headerlink" title="2.1 apoc的安装与配置"></a>2.1 apoc的安装与配置</h3><p>apoc默认状态下并未安装，所以我们要先安装。</p>
<h4 id="apoc-core的安装"><a href="#apoc-core的安装" class="headerlink" title="apoc-core的安装"></a>apoc-core的安装</h4><p>这个十分简单，在**$NEO4J_HOME&#x2F;labs**文件夹（NEO4J_HOME表示neo4j主目录）中，你会找到一个jar文件。</p>
<p><img src="https://s2.loli.net/2023/08/09/RACvOsangpDluyX.png" srcset="/img/loading.gif" lazyload alt="image-20230808103615755"></p>
<p>将这个文件复制到**$NEO4J_HOME&#x2F;plugins<strong>文件夹下，</strong>apoc-core**就算安装好了！</p>
<h4 id="apoc-core配置"><a href="#apoc-core配置" class="headerlink" title="apoc-core配置"></a>apoc-core配置</h4><p>a.首先，找到你的neo4j配置文件<strong>neo4j.conf</strong>，neo4j各文件在各操作系统的地址官方文档给出了，链接在前文。</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none"># 寻找并修改以下设置，推荐复制粘贴原有的然后去掉注释的#，再修改，方便之后还原默认设置


# 放宽apoc权限
dbms.security.procedures.unrestricted&#x3D;apoc.*,algo.*
# 将apoc的全部都加入allowlist
dbms.security.procedures.allowlist&#x3D;apoc.*,apoc.coll.*,apoc.load.*,gds.*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>b.之后在neo4j.conf同文件夹下创建一个apoc.conf文件，这个是apoc的配置文件，是要自己手动创建的。</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none"># 加入下面三条设置

# 开启文件导出功能
apoc.export.file.enabled&#x3D;true
# 开启文件导入功能
apoc.import.file.enabled&#x3D;true
# 指明是否使用 neo4j.conf 指定的相关（导入导出涉及的）目录(默认就是 true)
apoc.import.file_use_neo4j_config&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>&nbsp;</p>
<p>好了，接下来我们就可以使用apoc-core来导入导出了。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3 id="2-2-导出为csv文件"><a href="#2-2-导出为csv文件" class="headerlink" title="2.2 导出为csv文件"></a>2.2 导出为csv文件</h3><p><strong>注意</strong>：这次启动方式<strong>不是neo4j start</strong>而是<strong>neo4j console</strong>，而只有这种启动才能顺利使用apoc</p>
<p>neo4j官方只能导出数据为dump或stream，而apoc让我们有了更多选择。</p>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/docs/apoc/current/export/csv/">apoc.export.csv</a></p>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span>export<span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">.</span><span class="token keyword">all</span><span class="token punctuation">(</span><span class="token string">"movies.csv"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 短短一句，就可将你的全部nodes和relationships导出成一个csv文件</span>
<span class="token comment">// 而由于我们在apoc.conf文件中第三条设置为TRUE，所以导出的文件将位于noe4j的import文件夹下</span>
<span class="token comment">// 当然你也可以将设置改为false，并且给出文件的绝对路径，来自定义文件的导出位置</span>
<span class="token comment">// 注意！！修改设置后noe4j可以在你电脑上任意位置输出文件，注意文件导出地址安全性，别写在不该写的地方！</span>
               
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span>export<span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">.</span><span class="token keyword">all</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>stream<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 这样你的文件将导出成一个stream</span>
                      
<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>person<span class="token operator">:</span><span class="token class-name">Person</span><span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> person<span class="token punctuation">.</span>name <span class="token keyword">STARTS</span> <span class="token keyword">WITH</span> <span class="token string">"L"</span>
<span class="token keyword">WITH</span> <span class="token function">collect</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token keyword">AS</span> people
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span>export<span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>people<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"movies-l.csv"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">YIELD</span> file<span class="token punctuation">,</span> source<span class="token punctuation">,</span> format<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> relationships<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> time<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> batchSize<span class="token punctuation">,</span> batches<span class="token punctuation">,</span> done<span class="token punctuation">,</span> data
<span class="token keyword">RETURN</span> file<span class="token punctuation">,</span> source<span class="token punctuation">,</span> format<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> relationships<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> time<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> batchSize<span class="token punctuation">,</span> batches<span class="token punctuation">,</span> done<span class="token punctuation">,</span> data
<span class="token comment">// 这样，我们就可以选择性的导出nodes</span>
<span class="token comment">// 同时，我们注意到 apoc.export.csv.data第一个参数为nodes，第二个其实是relationships</span>
<span class="token comment">// 而哪怕这里不导出关系，我们依旧要写一个[]保留位置，就和config参数的&#123;&#125;一样</span>
                
<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>person<span class="token operator">:</span><span class="token class-name">Person</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>actedIn<span class="token operator">:</span><span class="token relationship property">ACTED_IN</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token punctuation">(</span>movie<span class="token operator">:</span><span class="token class-name">Movie</span><span class="token punctuation">)</span>
<span class="token keyword">WITH</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> person<span class="token punctuation">)</span> <span class="token keyword">AS</span> people<span class="token punctuation">,</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> movie<span class="token punctuation">)</span> <span class="token keyword">AS</span> movies<span class="token punctuation">,</span> <span class="token function">collect</span><span class="token punctuation">(</span>actedIn<span class="token punctuation">)</span> <span class="token keyword">AS</span> actedInRels
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span>export<span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>people <span class="token operator">+</span> movies<span class="token punctuation">,</span> actedInRels<span class="token punctuation">,</span> <span class="token string">"movies-actedIn.csv"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">YIELD</span> file<span class="token punctuation">,</span> source<span class="token punctuation">,</span> format<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> relationships<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> time<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> batchSize<span class="token punctuation">,</span> batches<span class="token punctuation">,</span> done<span class="token punctuation">,</span> data
<span class="token keyword">RETURN</span> file<span class="token punctuation">,</span> source<span class="token punctuation">,</span> format<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> relationships<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> time<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> batchSize<span class="token punctuation">,</span> batches<span class="token punctuation">,</span> done<span class="token punctuation">,</span> data
<span class="token comment">// 我们选择性的导出了nodes和relationships</span>
   
                        
<span class="token keyword">WITH</span> "<span class="token keyword">MATCH</span> path <span class="token operator">=</span> <span class="token punctuation">(</span>person<span class="token operator">:</span><span class="token class-name">Person</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">:</span><span class="token relationship property">DIRECTED</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
      <span class="token keyword">RETURN</span> person<span class="token punctuation">.</span>name <span class="token keyword">AS</span> name<span class="token punctuation">,</span> person<span class="token punctuation">.</span>born <span class="token keyword">AS</span> born<span class="token punctuation">,</span>
             movie<span class="token punctuation">.</span>title <span class="token keyword">AS</span> title<span class="token punctuation">,</span> movie<span class="token punctuation">.</span>tagline <span class="token keyword">AS</span> tagline<span class="token punctuation">,</span> movie<span class="token punctuation">.</span>released <span class="token keyword">AS</span> released" <span class="token keyword">AS</span> query
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span>export<span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">"movies-directed.csv"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">YIELD</span> file<span class="token punctuation">,</span> source<span class="token punctuation">,</span> format<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> relationships<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> time<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> batchSize<span class="token punctuation">,</span> batches<span class="token punctuation">,</span> done<span class="token punctuation">,</span> data
<span class="token keyword">RETURN</span> file<span class="token punctuation">,</span> source<span class="token punctuation">,</span> format<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> relationships<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> time<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> batchSize<span class="token punctuation">,</span> batches<span class="token punctuation">,</span> done<span class="token punctuation">,</span> data<span class="token punctuation">;</span>
<span class="token comment">//这是一个与之前不同的方法，在这里我们传入的不是nodes或relationships，而是一个语句，这样子看上去简单多了</span>
                
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>大家或许注意到了，上述许多语句{}中的内容不是stream:true就是空的，其实，这里面可以设置很多配置</p>
<p>如下所示：</p>
<p><img src="https://s2.loli.net/2023/08/09/unIXg3w9VOToxEN.png" srcset="/img/loading.gif" lazyload alt="image-20230808204348546"></p>
<p><strong>但是</strong>，其中的<strong>bulkImport</strong>设置只有在all和graph情况下才能生效：</p>
<p><img src="https://s2.loli.net/2023/08/09/pvPhyGdFDw8fBoT.png" srcset="/img/loading.gif" lazyload alt="image-20230808204725076"></p>
<p>&nbsp;</p>
<h3 id="2-3导出为json文件"><a href="#2-3导出为json文件" class="headerlink" title="2.3导出为json文件"></a>2.3导出为json文件</h3><figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token comment">// 基本与csv相同</span>
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span>export<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token keyword">all</span><span class="token punctuation">(</span><span class="token string">"all.json"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>useTypes<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// useTypes参数表明输出时是否表明type类型是node还是relationship</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<figure><div class="code-wrapper"><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// out</span>
<span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"node"</span><span class="token punctuation">,</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"born"</span><span class="token operator">:</span><span class="token string">"2015-07-04T19:32:24"</span><span class="token punctuation">,</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Adam"</span><span class="token punctuation">,</span><span class="token property">"place"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"crs"</span><span class="token operator">:</span><span class="token string">"wgs-84"</span><span class="token punctuation">,</span><span class="token property">"latitude"</span><span class="token operator">:</span><span class="token number">13.1</span><span class="token punctuation">,</span><span class="token property">"longitude"</span><span class="token operator">:</span><span class="token number">33.46789</span><span class="token punctuation">,</span><span class="token property">"height"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token property">"male"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">"kids"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"Sam"</span><span class="token punctuation">,</span><span class="token string">"Anna"</span><span class="token punctuation">,</span><span class="token string">"Grace"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"node"</span><span class="token punctuation">,</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Jim"</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"node"</span><span class="token punctuation">,</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"relationship"</span><span class="token punctuation">,</span><span class="token property">"label"</span><span class="token operator">:</span><span class="token string">"KNOWS"</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"bffSince"</span><span class="token operator">:</span><span class="token string">"P5M1DT12H"</span><span class="token punctuation">,</span><span class="token property">"since"</span><span class="token operator">:</span><span class="token number">1993</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"start"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"born"</span><span class="token operator">:</span><span class="token string">"2015-07-04T19:32:24"</span><span class="token punctuation">,</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Adam"</span><span class="token punctuation">,</span><span class="token property">"place"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"crs"</span><span class="token operator">:</span><span class="token string">"wgs-84"</span><span class="token punctuation">,</span><span class="token property">"latitude"</span><span class="token operator">:</span><span class="token number">13.1</span><span class="token punctuation">,</span><span class="token property">"longitude"</span><span class="token operator">:</span><span class="token number">33.46789</span><span class="token punctuation">,</span><span class="token property">"height"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token property">"male"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">"kids"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"Sam"</span><span class="token punctuation">,</span><span class="token string">"Anna"</span><span class="token punctuation">,</span><span class="token string">"Grace"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"end"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Jim"</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>&nbsp;</p>
<h3 id="2-4导出为Cypher语句"><a href="#2-4导出为Cypher语句" class="headerlink" title="2.4导出为Cypher语句"></a>2.4导出为Cypher语句</h3><figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span>export<span class="token punctuation">.</span>cypher<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">YIELD</span> format<span class="token punctuation">,</span> time<span class="token punctuation">,</span> cypherStatements
<span class="token keyword">RETURN</span> format<span class="token punctuation">,</span> time<span class="token punctuation">,</span> cypherStatements<span class="token punctuation">;</span>

<span class="token comment">// 也与csv大同小异，多了一个schema，这个就支持导出索引以及所有的限制条件的建立，而不仅仅是一些数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>&nbsp;</p>
<h3 id="2-5导出为graphml文件"><a href="#2-5导出为graphml文件" class="headerlink" title="2.5导出为graphml文件"></a>2.5导出为graphml文件</h3><blockquote>
<p><em>The export GraphML procedures export data into a format that’s used by other tools like Gephi and CytoScape to read graph data.</em></p>
<p>主要是导出给Gephi 使用</p>
</blockquote>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token comment">// example</span>
<span class="token keyword">call</span> apoc<span class="token punctuation">.</span>export<span class="token punctuation">.</span>graphml<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'MATCH (start:Foo)-[:KNOWS]->(:Bar) RETURN start'</span><span class="token punctuation">,</span> <span class="token string">'queryNodesFoo.graphml'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>useTypes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure>

<figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- out --></span>
<span class="token prolog">&lt;?xml version='1.0' encoding='UTF-8'?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>graphml</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://graphml.graphdrawing.org/xmlns<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://graphml.graphdrawing.org/xmlns http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>born<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>node<span class="token punctuation">"</span></span> <span class="token attr-name">attr.name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>born<span class="token punctuation">"</span></span> <span class="token attr-name">attr.type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>node<span class="token punctuation">"</span></span> <span class="token attr-name">attr.name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">attr.type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>place<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>node<span class="token punctuation">"</span></span> <span class="token attr-name">attr.name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>place<span class="token punctuation">"</span></span> <span class="token attr-name">attr.type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>labels<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>node<span class="token punctuation">"</span></span> <span class="token attr-name">attr.name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>labels<span class="token punctuation">"</span></span> <span class="token attr-name">attr.type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>graph</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>G<span class="token punctuation">"</span></span> <span class="token attr-name">edgedefault</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>directed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>n0<span class="token punctuation">"</span></span> <span class="token attr-name">labels</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>:Foo:Foo0:Foo2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>labels<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>:Foo:Foo0:Foo2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>born<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2018-10-10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>place<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;"crs":"wgs-84-3d","latitude":12.78,"longitude":56.7,"height":100.0&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>node</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>n3<span class="token punctuation">"</span></span> <span class="token attr-name">labels</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>:Foo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>labels<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>:Foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>zzz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>node</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>n5<span class="token punctuation">"</span></span> <span class="token attr-name">labels</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>:Foo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>labels<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>:Foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>aaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>node</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>graph</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>graphml</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>&nbsp;</p>
<p>&nbsp;</p>
<blockquote>
<p>apoc-extended 的导入还支持导入excel文件，但是不能是最新的5.10版本的neo4j。</p>
</blockquote>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id="3-利用apoc在线导入"><a href="#3-利用apoc在线导入" class="headerlink" title="3.利用apoc在线导入"></a>3.利用apoc在线导入</h2><hr>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/docs/apoc/current/">apoc-core</a></p>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/labs/apoc/5/">apoc-extended</a></p>
<h3 id="3-1-从Web-APIs导入"><a href="#3-1-从Web-APIs导入" class="headerlink" title="3.1 从Web-APIs导入"></a>3.1 从Web-APIs导入</h3><blockquote>
<p><em>As <code>apoc.import.file.use_neo4j_config</code> is enabled, the procedures check whether file system access is allowed and possibly constrained to a specific directory by reading the two configuration parameters <code>dbms.security.allow_csv_import_from_file_urls</code> and <code>server.directories.import</code> respectively. If you want to remove these constraints please set <code>apoc.import.file.use_neo4j_config=false</code></em></p>
</blockquote>
<p>如果 <code>apoc.import.file.use_neo4j_config</code>设置为true，文件写入可能会有所限制。可以设为false，但是要注意安全性。</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token comment">// example，可以用url导入数据</span>
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span><span class="token keyword">load</span><span class="token punctuation">.</span><span class="token function">xml</span><span class="token punctuation">(</span><span class="token string">'http://example.com/test.xml'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'xPath'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>config<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">YIELD</span> value <span class="token keyword">as</span> doc <span class="token keyword">CREATE</span> <span class="token punctuation">(</span>p<span class="token operator">:</span><span class="token class-name">Person</span><span class="token punctuation">)</span> <span class="token keyword">SET</span> p<span class="token punctuation">.</span>name <span class="token operator">=</span> doc<span class="token punctuation">.</span>name
  
<span class="token comment">// 还可以从google cloud storage导入数据导入数据，但是要另外加一堆插件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>&nbsp;</p>
<h3 id="3-2-load-csv文件"><a href="#3-2-load-csv文件" class="headerlink" title="3.2 load csv文件"></a>3.2 load csv文件</h3><p>这是需安装apoc-extended，比较实用，提一下。</p>
<blockquote>
<ul>
<li>provide a line number</li>
<li>provide both a map and a list representation of each line</li>
<li>automatic data conversion (including split into arrays)</li>
<li>option to keep the original string formatted values</li>
<li>ignoring fields (makes it easier to assign a full line as properties)</li>
<li>headerless files</li>
<li>replacing certain values with null</li>
</ul>
</blockquote>
<p> 上述便是apoc在load csv方面相对官方方法的改进</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span><span class="token keyword">load</span><span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">(</span><span class="token string">'test.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">YIELD</span> lineNo<span class="token punctuation">,</span> map<span class="token punctuation">,</span> list
<span class="token keyword">RETURN</span> <span class="token operator">*</span><span class="token punctuation">;</span>



<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span><span class="token keyword">load</span><span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> map <span class="token keyword">as</span> row <span class="token keyword">return</span> row
<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>p<span class="token operator">:</span><span class="token class-name">Person</span><span class="token punctuation">)</span> <span class="token keyword">SET</span> p <span class="token operator">=</span> row
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>多种配置任你选择：</p>
<p><img src="https://s2.loli.net/2023/08/09/Ln6vM7k2oIEURwm.png" srcset="/img/loading.gif" lazyload alt="image-20230809102037522"></p>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span><span class="token keyword">load</span><span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">(</span><span class="token string">'test.csv'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token keyword">skip</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">limit</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> header<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> ignore<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   mapping<span class="token operator">:</span><span class="token punctuation">&#123;</span>
     age<span class="token operator">:</span> <span class="token punctuation">&#123;</span>type<span class="token operator">:</span><span class="token string">'int'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
     beverage<span class="token operator">:</span> <span class="token punctuation">&#123;</span>array<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> arraySep<span class="token operator">:</span><span class="token string">';'</span><span class="token punctuation">,</span> name<span class="token operator">:</span><span class="token string">'drinks'</span><span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">YIELD</span> lineNo<span class="token punctuation">,</span> map<span class="token punctuation">,</span> list
<span class="token keyword">RETURN</span> <span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token comment">// 其中地一个设置是针对文件的，第二个是针对读入的map</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>&nbsp;</p>
<h3 id="3-3-导入excel文件"><a href="#3-3-导入excel文件" class="headerlink" title="3.3 导入excel文件"></a>3.3 导入excel文件</h3><p>这个是在安装apoc-extended基础下的，因为比较常用了，稍微提一下。但是因为支持该功能的文件太大了，所以apoc将其分离出去了，你需另外下载支持文件安装到plugins文件夹下。</p>
<blockquote>
<p>For loading XLS we’re using the Apache POI library, which works well with old and new Excel formats, but is quite large. That’s why we decided not to include it into the apoc jar, but make it an optional dependency.</p>
<p>These dependencies are included in <a target="_blank" rel="noopener" href="https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/download/5.9.0/apoc-xls-dependencies-5.9.0-all.jar">apoc-xls-dependencies-5.9.0-all.jar</a>, which can be downloaded from the <a target="_blank" rel="noopener" href="https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/tag/5.9.0">releases page</a>. Once that file is downloaded, it should be placed in the <code>plugins</code> directory and the Neo4j Server restarted.</p>
<p><strong>Alternatively</strong>, you can download these jars from Maven Repository (putting them into <code>plugins</code> directory as well):</p>
<p>For XLS files:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/org/apache/poi/poi/5.1.0/poi-5.1.0.jar">poi-5.1.0.jar</a></li>
</ul>
<p>Additional for XLSX files:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/org/apache/commons/commons-collections4/4.4/commons-collections4-4.4.jar">commons-collections4-4.4.jar</a></li>
<li><a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/org/apache/poi/poi-ooxml/5.1.0/poi-ooxml-5.1.0.jar">poi-ooxml-5.1.0.jar</a></li>
<li><a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/org/apache/poi/poi-ooxml-lite/5.1.0/poi-ooxml-lite-5.1.0.jar">poi-ooxml-lite-5.1.0.jar</a></li>
<li><a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/org/apache/xmlbeans/xmlbeans/5.0.2/xmlbeans-5.0.2.jar">xmlbeans-5.0.2.jar</a></li>
<li><a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/com/github/virtuald/curvesapi/1.06/curvesapi-1.06.jar">curvesapi-1.06.jar</a></li>
</ul>
</blockquote>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token comment">// 同样简单明了</span>
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span><span class="token keyword">load</span><span class="token punctuation">.</span><span class="token function">xls</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>Name <span class="token keyword">of</span> sheet<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>config<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
   
<span class="token comment">// 这里是'Full',整个文件全导入</span>
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span><span class="token keyword">load</span><span class="token punctuation">.</span><span class="token function">xls</span><span class="token punctuation">(</span><span class="token string">'file:///path/to/file.xls'</span><span class="token punctuation">,</span><span class="token string">'Full'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>mapping<span class="token operator">:</span><span class="token punctuation">&#123;</span>Integer<span class="token operator">:</span><span class="token punctuation">&#123;</span>type<span class="token operator">:</span><span class="token string">'int'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> Array<span class="token operator">:</span><span class="token punctuation">&#123;</span>type<span class="token operator">:</span><span class="token string">'int'</span><span class="token punctuation">,</span>array<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>arraySep<span class="token operator">:</span><span class="token string">';'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                                                               
<span class="token comment">// 至于导入后再怎么处理，其实就和导入csv后处理一样，官方文档看一下load csv相关文档即可</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>config格式如下：</p>
<p><img src="https://s2.loli.net/2023/08/09/XZM1UFAmkbGdew7.png" srcset="/img/loading.gif" lazyload alt="image-20230809103254865"></p>
<p>&nbsp;</p>
<h3 id="3-4-import-csv文件"><a href="#3-4-import-csv文件" class="headerlink" title="3.4 import csv文件"></a>3.4 import csv文件</h3><p>在apoc中，<strong>load</strong>和<strong>import</strong>其实是有一定区别的。</p>
<p><strong>load</strong>是导入neo4j类似缓存中，可以做后续操作后再导入neo4j数据库中（当然，也可以不导入）</p>
<p><strong>import</strong>是运行后就将数据存储入数据库中。</p>
<p>&nbsp;</p>
<p>而在apoc-core官方文档中提到：只要是满足apoc的csv文件格式规则的，就可以使用 <code>apoc.import.csv</code>来导入数据，但是对于大型数据，他们更推荐官方的import方式。（就是上文提到的终端下的 <code>neo4j-admin database import</code>）</p>
<p>&nbsp;</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher"><span class="token comment">// apoc.import.csv(&lt;nodes>, &lt;relationships>, &lt;config>)</span>

<span class="token comment">// 其中nodes和relationships都是以list，即[]的形式传入</span>
<span class="token comment">// 而list中单个node或relationship又以map的形式传入</span>

<span class="token comment">// &lt;nodes>: [&#123;fileName: 'file:/persons.csv', labels: ['Teacher','Student']&#125;]</span>
<span class="token comment">// 传入文件，以及文件中所含的标签</span>

<span class="token comment">// &lt;relationships>: [&#123;fileName:'file:/...',type:'KNOWS'&#125;]</span>
<span class="token comment">// 传入文件以及关系的type</span>

<span class="token comment">//注意！！map的关键字（key）一定要严格按照上方写，fileName写成filename就会出错！！</span>

<span class="token comment">// example</span>
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span>import<span class="token punctuation">.</span><span class="token keyword">csv</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>fileName<span class="token operator">:</span> <span class="token string">'file:/persons.csv'</span><span class="token punctuation">,</span> labels<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Person'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>fileName<span class="token operator">:</span> <span class="token string">'file:/knows.csv'</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">'KNOWS'</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>delimiter<span class="token operator">:</span> <span class="token string">'|'</span><span class="token punctuation">,</span> arrayDelimiter<span class="token operator">:</span> <span class="token string">','</span><span class="token punctuation">,</span> stringIds<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>config中可选配置如下：</p>
<p><img src="https://s2.loli.net/2023/08/20/eAjxtrqD2yCGz68.png" srcset="/img/loading.gif" lazyload alt="image-20230812113109487"></p>
<p>&nbsp;</p>
<h3 id="3-5-导入json文件"><a href="#3-5-导入json文件" class="headerlink" title="3.5 导入json文件"></a>3.5 导入json文件</h3><ul>
<li><strong>apoc.load.json()</strong></li>
</ul>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher">apoc<span class="token punctuation">.</span><span class="token keyword">load</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>urlOrKeyOrBinary <span class="token operator">:</span><span class="token operator">:</span> ANY?<span class="token punctuation">,</span> path <span class="token operator">=</span>  <span class="token operator">:</span><span class="token operator">:</span> STRING?<span class="token punctuation">,</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">:</span><span class="token operator">:</span> MAP?<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">:</span> <span class="token punctuation">(</span>value <span class="token operator">:</span><span class="token operator">:</span> MAP?<span class="token punctuation">)</span>
<span class="token comment">// apoc.load.json</span>
<span class="token comment">// 其中的path可以使用jsonPath，来指定导入内容</span>

<span class="token comment">//example</span>
<span class="token keyword">CALL</span> apoc<span class="token punctuation">.</span><span class="token keyword">load</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">"file:///person.json"</span><span class="token punctuation">)</span>
<span class="token keyword">YIELD</span> value
<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>p<span class="token operator">:</span><span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>name<span class="token operator">:</span> value<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">SET</span> p<span class="token punctuation">.</span>age <span class="token operator">=</span> value<span class="token punctuation">.</span>age
<span class="token keyword">WITH</span> p<span class="token punctuation">,</span> value
<span class="token keyword">UNWIND</span> value<span class="token punctuation">.</span>children <span class="token keyword">AS</span> child
<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>c<span class="token operator">:</span><span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>name<span class="token operator">:</span> child<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">:</span><span class="token relationship property">CHILD_OF</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>config:</p>
<p><img src="https://s2.loli.net/2023/08/20/KzAPO42uxgt8l3y.png" srcset="/img/loading.gif" lazyload alt="image-20230815205853386"></p>
<ul>
<li><strong>apoc.import.json()</strong></li>
</ul>
<figure><div class="code-wrapper"><pre class="line-numbers language-cypher" data-language="cypher"><code class="language-cypher">apoc<span class="token punctuation">.</span>import<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>urlOrBinaryFile Any<span class="token punctuation">,</span> config Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token comment">// import和load不一样，load后是要将数据进行后续操作，不一定保存到数据库中</span>
<span class="token comment">// import的作用就是将数据导入</span>
<span class="token comment">// 而通过观察import的signature我们可以发现，它不接受path参数，</span>
<span class="token comment">// 这意味着import只能整个文件导入，那么这个文件要求保持一定格式规范，最好是通过apoc导出的json文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>导入的json文件样例:</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"node"</span><span class="token punctuation">,</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"born"</span><span class="token operator">:</span><span class="token string">"2015-07-04T19:32:24"</span><span class="token punctuation">,</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Adam"</span><span class="token punctuation">,</span><span class="token property">"place"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"crs"</span><span class="token operator">:</span><span class="token string">"wgs-84"</span><span class="token punctuation">,</span><span class="token property">"latitude"</span><span class="token operator">:</span><span class="token number">13.1</span><span class="token punctuation">,</span><span class="token property">"longitude"</span><span class="token operator">:</span><span class="token number">33.46789</span><span class="token punctuation">,</span><span class="token property">"height"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token property">"male"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">"kids"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"Sam"</span><span class="token punctuation">,</span><span class="token string">"Anna"</span><span class="token punctuation">,</span><span class="token string">"Grace"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"node"</span><span class="token punctuation">,</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Jim"</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"node"</span><span class="token punctuation">,</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"relationship"</span><span class="token punctuation">,</span><span class="token property">"label"</span><span class="token operator">:</span><span class="token string">"KNOWS"</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"bffSince"</span><span class="token operator">:</span><span class="token string">"P5M1DT12H"</span><span class="token punctuation">,</span><span class="token property">"since"</span><span class="token operator">:</span><span class="token number">1993</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"start"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"born"</span><span class="token operator">:</span><span class="token string">"2015-07-04T19:32:24"</span><span class="token punctuation">,</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Adam"</span><span class="token punctuation">,</span><span class="token property">"place"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"crs"</span><span class="token operator">:</span><span class="token string">"wgs-84"</span><span class="token punctuation">,</span><span class="token property">"latitude"</span><span class="token operator">:</span><span class="token number">13.1</span><span class="token punctuation">,</span><span class="token property">"longitude"</span><span class="token operator">:</span><span class="token number">33.46789</span><span class="token punctuation">,</span><span class="token property">"height"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token property">"male"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">"kids"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"Sam"</span><span class="token punctuation">,</span><span class="token string">"Anna"</span><span class="token punctuation">,</span><span class="token string">"Grace"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"end"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"labels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"User"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"properties"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Jim"</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<p>config：</p>
<p><img src="https://s2.loli.net/2023/08/20/kazcpEDhY3Iu69P.png" srcset="/img/loading.gif" lazyload alt="image-20230819083810885"></p>
<p><img src="https://s2.loli.net/2023/08/20/Pgyr457X1MLF86Y.png" srcset="/img/loading.gif" lazyload alt="image-20230819083839427"></p>
<p>&nbsp;</p>
<p>apoc-core还支持导入<strong>xml</strong>文件和<strong>graphml</strong>，与前面的json等基本一致，这里就不介绍了，大家可以看一下官方文档。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id="4-复制数据库秘籍——复制文件夹大法"><a href="#4-复制数据库秘籍——复制文件夹大法" class="headerlink" title="4. 复制数据库秘籍——复制文件夹大法"></a>4. 复制数据库秘籍——复制文件夹大法</h2><p>当我们要将海量的数据从一个neo4j数据库导入另一台计算机的neo4j数据库时，如果采用上述的办法，或许要等非常长的时间。此时我们就可以直接复制文件。</p>
<p>具体步骤如下：</p>
<ol>
<li>假设我们<strong>被复制</strong>的数据库的名字为<strong>Data.db</strong>。</li>
<li>打开需要复制数据的电脑（即数据源）的 <strong>neo4j主目录&#x2F;data&#x2F;</strong> ，在其目录下有两个文件夹，<strong>databases</strong>和<strong>transactions</strong>。在这两个数据夹下各有一个<strong>Data.db</strong>文件夹，这就是neo4j的<strong>Data.db</strong>数据库存储的数据。</li>
<li>拷贝这两个文件夹到需要导入的电脑，放置在同样的目录下。<em><strong>注意！</strong></em>一定要放在同样的目录下，由于两个文件夹是同名的，所以注意别放错了地方。</li>
<li>新建database，我推荐是和<strong>被复制</strong>的数据库同名，即<strong>Data.db</strong>。这个我个人试过，肯定没问题。你也可以试试建一个<strong>myData.db</strong>，然后把那两个文件夹重命名为<strong>myData.db</strong>。</li>
</ol>
<p>提示：可能会在复制粘贴文件夹时提示无权限修改或权限不足一类的，linux操作系统可以在终端中使用 <code>sudo mv -i 所需复制的文件 目的地</code></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/neo4j/" class="print-no-link">#neo4j</a>
      
        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="print-no-link">#数据库</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/hello-world/" title="Hello World">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Hello World</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/ubuntu%E4%B8%AD%E7%9A%84n%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3/" title="Ubuntu（22.04）中的常见问题及解决">
                        <span class="hidden-mobile">Ubuntu（22.04）中的常见问题及解决</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'spysyyrps/spysyyrps.github.io');
      s.setAttribute('issue-term', 'title');
      
      s.setAttribute('label', '指正错误，分享知识，讨论问题！');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
